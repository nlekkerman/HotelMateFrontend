<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>WebXR Hit‑Test AR</title>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script>
      AFRAME.registerComponent('hit-test', {
        init: function () {
          this.el.sceneEl.renderer.xr.addEventListener('sessionstart', (e) => {
            const session = e.session;
            session.requestReferenceSpace('viewer').then((refSpace) => {
              session.requestHitTestSource({ space: refSpace }).then((source) => {
                this.hitTestSource = source;
              });
            });
          });
        },
        tick: function () {
          const xrFrame = this.el.sceneEl.renderer.xr.getFrame();
          const referenceSpace = this.el.sceneEl.renderer.xr.getReferenceSpace();
          if (this.hitTestSource && xrFrame) {
            const hitTestResults = xrFrame.getHitTestResults(this.hitTestSource);
            if (hitTestResults.length) {
              const pose = hitTestResults[0].getPose(referenceSpace);
              this.el.object3D.position.copy(pose.transform.position);
              this.el.object3D.quaternion.copy(pose.transform.orientation);
            }
          }
        }
      });
    </script>
    <style> body, html { margin: 0; padding: 0; overflow: hidden; height: 100%; } </style>
  </head>
  <body>
    <a-scene
      embedded
      webxr="optionalFeatures: hit-test; mode: ar;"
      vr-mode-ui="enabled: false"
      device-orientation-permission-ui="enabled: true"
      style="width: 100vw; height: 100vh; background: transparent;"
    >
      <!-- Hit‑test component listens for real‑world surfaces -->
      <a-entity webxr="optionalFeatures: hit-test"></a-entity>

      <!-- Box will be placed on detected surface -->
      <a-box hit-test position="0 0 -1" material="color: yellow"></a-box>

      <a-entity camera></a-entity>
    </a-scene>
  </body>
</html>
