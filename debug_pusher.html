<!DOCTYPE html>
<html>
<head>
    <title>Pusher Debug Tool</title>
    <script src="https://js.pusher.com/8.2.0/pusher.min.js"></script>
</head>
<body>
    <h1>Pusher Debug Tool</h1>
    <div id="logs"></div>
    <button onclick="testStaffChatSubscription()">Test Staff Chat Subscription</button>
    
    <script>
        const logs = document.getElementById('logs');
        
        function log(message) {
            const p = document.createElement('p');
            p.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            logs.appendChild(p);
            console.log(message);
        }
        
        // Initialize Pusher (you'll need to replace with actual keys)
        const pusher = new Pusher('YOUR_PUSHER_KEY', {
            cluster: 'mt1',
            encrypted: true,
            forceTLS: true,
            authEndpoint: 'http://localhost:8000/api/pusher/auth',  // Replace with your backend URL
            auth: {
                headers: {
                    'Authorization': 'Bearer YOUR_AUTH_TOKEN'  // Replace with actual token
                }
            }
        });
        
        pusher.connection.bind('connecting', () => {
            log('ðŸ”„ Pusher connecting...');
        });
        
        pusher.connection.bind('connected', () => {
            log('âœ… Pusher connected!');
        });
        
        pusher.connection.bind('error', (error) => {
            log('âŒ Pusher connection error: ' + JSON.stringify(error));
        });
        
        function testStaffChatSubscription() {
            const channelName = 'hotel-killarney.staff-chat.100';  // Replace with actual values
            log(`ðŸ”” Subscribing to channel: ${channelName}`);
            
            const channel = pusher.subscribe(channelName);
            
            channel.bind('pusher:subscription_succeeded', () => {
                log(`âœ… Successfully subscribed to: ${channelName}`);
            });
            
            channel.bind('pusher:subscription_error', (error) => {
                log(`âŒ Subscription error for ${channelName}: ${JSON.stringify(error)}`);
            });
            
            // Listen for message events
            channel.bind('realtime_staff_chat_message_created', (data) => {
                log(`ðŸ“¨ Message event received: ${JSON.stringify(data, null, 2)}`);
            });
            
            // Listen for all events
            channel.bind_global((eventName, data) => {
                log(`ðŸš€ Event received on ${channelName}: ${eventName} - ${JSON.stringify(data)}`);
            });
        }
    </script>
</body>
</html>